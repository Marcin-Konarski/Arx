SELECT u.id, u.email, u.username, u.is_verified, k.public_key, k.id AS userkey_id FROM accounts_user as u INNER JOIN accounts_userkey as k ON u.id = k.user_id;



SELECT i.id AS note_share_id, n.id AS note_id, n.title, n.is_encrypted, n.owner_id, i.encrypted_symmetric_key AS key, i.user_key_id, i.permission FROM notes_note AS n LEFT JOIN notes_noteitem AS i ON n.id = i.note_id ORDER BY note_id;



POST /users/users/
{
    "username": "",
    "email": "",
    "password": ""
}


GET /users/users/me/


PUT /users/users/me/
{
    "username": "",
    "email": "",
}


DELETE /users/users/me/


POST /users/jwt/create/
{
    "username": "",
    "password": ""
}

PUT /users/jwt/refresh/
{
}


POST /users/keys/
{
    "public_key": ""
}


GET /users/keys/me/


GET /users/keys/<id>/
# TODO: This endpoint is not secure as it allows everyone to view everyone's key. Ensure that only owner can see their keys or delete this endpoint at all


DELETE /users/keys/<id>/
# TODO: This endpoint is not secure as it allows everyone to view everyone's key. Ensure that only owner can delete their keys

POST /notes/notes/
{
    "title": "",
    "body": "",
    "is_encrypted": true/false,
    "encryption_key": ""
}


GET /notes/notes/me/


GET /notes/notes/<id>/


PUT /notes/notes/<id>/
{
    "title": "",
    "body": ""
}


PUT /notes/notes/<id>/change_encryption/
{
    "new_body": "",
    "is_encrypted": true\false,
    "keys": [
        {
            "user_id": "",
            "key": ""
        },
        {
            "user_id": "",
            "key": ""
        }
    ]
}


POST http://127.0.0.1:8000/notes/notes/<id>/share/
{
    "user": "",
    "encryption_key": "",
    "permission": ""
}





# TODO: Make `GET /notes/notes/me/` display all notes user has access to - not only owned by user
# TOTO: Make `GET /users/keys/me/` endpoint that returns UserKey_id and the actual key
# TODO: Make `PUT /notes/notes/<id>/change_encryption/` messages more explicit. Especially in the `"Key 1: 'key' field is required"` message should include user id instead of key number: e.g. `"key_field_missing": "'key' field for user <id> is required"`